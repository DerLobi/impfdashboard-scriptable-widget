{"version":3,"file":"vega-loader.min.js","sources":["../src/loader.js","../src/type.js","../../../node_modules/d3-dsv/src/dsv.js","../src/formats/dsv.js","../src/formats/json.js","../../../node_modules/topojson-client/src/identity.js","../../../node_modules/topojson-client/src/feature.js","../../../node_modules/topojson-client/src/transform.js","../../../node_modules/topojson-client/src/reverse.js","../../../node_modules/topojson-client/src/stitch.js","../../../node_modules/topojson-client/src/mesh.js","../src/formats/topojson.js","../src/formats/index.js","../index.browser.js","../src/read.js"],"sourcesContent":["import {error, extend, isFunction, stringValue} from 'vega-util';\n\n// Matches absolute URLs with optional protocol\n//   https://...    file://...    //...\nconst protocol_re = /^([A-Za-z]+:)?\\/\\//;\n\n// Matches allowed URIs. From https://github.com/cure53/DOMPurify/blob/master/src/regexp.js with added file://\nconst allowed_re = /^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i; // eslint-disable-line no-useless-escape\nconst whitespace_re = /[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205f\\u3000]/g; // eslint-disable-line no-control-regex\n\n\n// Special treatment in node.js for the file: protocol\nconst fileProtocol = 'file://';\n\n/**\n * Factory for a loader constructor that provides methods for requesting\n * files from either the network or disk, and for sanitizing request URIs.\n * @param {function} fetch - The Fetch API for HTTP network requests.\n *   If null or undefined, HTTP loading will be disabled.\n * @param {object} fs - The file system interface for file loading.\n *   If null or undefined, local file loading will be disabled.\n * @return {function} A loader constructor with the following signature:\n *   param {object} [options] - Optional default loading options to use.\n *   return {object} - A new loader instance.\n */\nexport default function(fetch, fs) {\n  return options => ({\n    options: options || {},\n    sanitize: sanitize,\n    load: load,\n    fileAccess: !!fs,\n    file: fileLoader(fs),\n    http: httpLoader(fetch)\n  });\n}\n\n/**\n * Load an external resource, typically either from the web or from the local\n * filesystem. This function uses {@link sanitize} to first sanitize the uri,\n * then calls either {@link http} (for web requests) or {@link file} (for\n * filesystem loading).\n * @param {string} uri - The resource indicator (e.g., URL or filename).\n * @param {object} [options] - Optional loading options. These options will\n *   override any existing default options.\n * @return {Promise} - A promise that resolves to the loaded content.\n */\nasync function load(uri, options) {\n  const opt = await this.sanitize(uri, options),\n        url = opt.href;\n\n  return opt.localFile\n    ? this.file(url)\n    : this.http(url, options);\n}\n\n/**\n * URI sanitizer function.\n * @param {string} uri - The uri (url or filename) to sanity check.\n * @param {object} options - An options hash.\n * @return {Promise} - A promise that resolves to an object containing\n *  sanitized uri data, or rejects it the input uri is deemed invalid.\n *  The properties of the resolved object are assumed to be\n *  valid attributes for an HTML 'a' tag. The sanitized uri *must* be\n *  provided by the 'href' property of the returned object.\n */\nasync function sanitize(uri, options) {\n  options = extend({}, this.options, options);\n\n  const fileAccess = this.fileAccess,\n        result = {href: null};\n\n  let isFile, loadFile, base;\n\n  const isAllowed = allowed_re.test(uri.replace(whitespace_re, ''));\n\n  if (uri == null || typeof uri !== 'string' || !isAllowed) {\n    error('Sanitize failure, invalid URI: ' + stringValue(uri));\n  }\n\n  const hasProtocol = protocol_re.test(uri);\n\n  // if relative url (no protocol/host), prepend baseURL\n  if ((base = options.baseURL) && !hasProtocol) {\n    // Ensure that there is a slash between the baseURL (e.g. hostname) and url\n    if (!uri.startsWith('/') && base[base.length-1] !== '/') {\n      uri = '/' + uri;\n    }\n    uri = base + uri;\n  }\n\n  // should we load from file system?\n  loadFile = (isFile = uri.startsWith(fileProtocol))\n    || options.mode === 'file'\n    || options.mode !== 'http' && !hasProtocol && fileAccess;\n\n  if (isFile) {\n    // strip file protocol\n    uri = uri.slice(fileProtocol.length);\n  } else if (uri.startsWith('//')) {\n    if (options.defaultProtocol === 'file') {\n      // if is file, strip protocol and set loadFile flag\n      uri = uri.slice(2);\n      loadFile = true;\n    } else {\n      // if relative protocol (starts with '//'), prepend default protocol\n      uri = (options.defaultProtocol || 'http') + ':' + uri;\n    }\n  }\n\n  // set non-enumerable mode flag to indicate local file load\n  Object.defineProperty(result, 'localFile', {value: !!loadFile});\n\n  // set uri\n  result.href = uri;\n\n  // set default result target, if specified\n  if (options.target) {\n    result.target = options.target + '';\n  }\n\n  // set default result rel, if specified (#1542)\n  if (options.rel) {\n    result.rel = options.rel + '';\n  }\n\n  // provide control over cross-origin image handling (#2238)\n  // https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image\n  if (options.context === 'image' && options.crossOrigin) {\n    result.crossOrigin = options.crossOrigin + '';\n  }\n\n  // return\n  return result;\n}\n\n/**\n * File system loader factory.\n * @param {object} fs - The file system interface.\n * @return {function} - A file loader with the following signature:\n *   param {string} filename - The file system path to load.\n *   param {string} filename - The file system path to load.\n *   return {Promise} A promise that resolves to the file contents.\n */\nfunction fileLoader(fs) {\n  return fs\n    ? filename => new Promise((accept, reject) => {\n        fs.readFile(filename, (error, data) => {\n          if (error) reject(error);\n          else accept(data);\n        });\n      })\n    : fileReject;\n}\n\n/**\n * Default file system loader that simply rejects.\n */\nasync function fileReject() {\n  error('No file system access.');\n}\n\n/**\n * HTTP request handler factory.\n * @param {function} fetch - The Fetch API method.\n * @return {function} - An http loader with the following signature:\n *   param {string} url - The url to request.\n *   param {object} options - An options hash.\n *   return {Promise} - A promise that resolves to the file contents.\n */\nfunction httpLoader(fetch) {\n  return fetch\n    ? async function(url, options) {\n        const opt = extend({}, this.options.http, options),\n              type = options && options.response,\n              response = await fetch(url, opt);\n\n        return !response.ok\n          ? error(response.status + '' + response.statusText)\n          : isFunction(response[type]) ? response[type]()\n          : response.text();\n      }\n    : httpReject;\n}\n\n/**\n * Default http request handler that simply rejects.\n */\nasync function httpReject() {\n  error('No HTTP fetch method available.');\n}\n","import {identity, toBoolean, toDate, toNumber, toString} from 'vega-util';\n\nconst isValid = _ => _ != null && _ === _;\n\nconst isBoolean = _ => _ === 'true'\n  || _ === 'false'\n  || _ === true\n  || _ === false;\n\nconst isDate = _ => !Number.isNaN(Date.parse(_));\n\nconst isNumber = _ => !Number.isNaN(+_) && !(_ instanceof Date);\n\nconst isInteger = _ => isNumber(_) && Number.isInteger(+_);\n\nexport const typeParsers = {\n  boolean: toBoolean,\n  integer: toNumber,\n  number:  toNumber,\n  date:    toDate,\n  string:  toString,\n  unknown: identity\n};\n\nconst typeTests = [\n  isBoolean,\n  isInteger,\n  isNumber,\n  isDate\n];\n\nconst typeList = [\n  'boolean',\n  'integer',\n  'number',\n  'date'\n];\n\nexport function inferType(values, field) {\n  if (!values || !values.length) return 'unknown';\n\n  const n = values.length,\n        m = typeTests.length,\n        a = typeTests.map((_, i) => i + 1);\n\n  for (let i = 0, t = 0, j, value; i < n; ++i) {\n    value = field ? values[i][field] : values[i];\n    for (j = 0; j < m; ++j) {\n      if (a[j] && isValid(value) && !typeTests[j](value)) {\n        a[j] = 0;\n        ++t;\n        if (t === typeTests.length) return 'string';\n      }\n    }\n  }\n\n  return typeList[\n    a.reduce((u, v) => u === 0 ? v : u, 0) - 1\n  ];\n}\n\nexport function inferTypes(data, fields) {\n  return fields.reduce((types, field) => {\n    types[field] = inferType(data, field);\n    return types;\n  }, {});\n}\n","var EOL = {},\n    EOF = {},\n    QUOTE = 34,\n    NEWLINE = 10,\n    RETURN = 13;\n\nfunction objectConverter(columns) {\n  return new Function(\"d\", \"return {\" + columns.map(function(name, i) {\n    return JSON.stringify(name) + \": d[\" + i + \"] || \\\"\\\"\";\n  }).join(\",\") + \"}\");\n}\n\nfunction customConverter(columns, f) {\n  var object = objectConverter(columns);\n  return function(row, i) {\n    return f(object(row), i, columns);\n  };\n}\n\n// Compute unique columns in order of discovery.\nfunction inferColumns(rows) {\n  var columnSet = Object.create(null),\n      columns = [];\n\n  rows.forEach(function(row) {\n    for (var column in row) {\n      if (!(column in columnSet)) {\n        columns.push(columnSet[column] = column);\n      }\n    }\n  });\n\n  return columns;\n}\n\nfunction pad(value, width) {\n  var s = value + \"\", length = s.length;\n  return length < width ? new Array(width - length + 1).join(0) + s : s;\n}\n\nfunction formatYear(year) {\n  return year < 0 ? \"-\" + pad(-year, 6)\n    : year > 9999 ? \"+\" + pad(year, 6)\n    : pad(year, 4);\n}\n\nfunction formatDate(date) {\n  var hours = date.getUTCHours(),\n      minutes = date.getUTCMinutes(),\n      seconds = date.getUTCSeconds(),\n      milliseconds = date.getUTCMilliseconds();\n  return isNaN(date) ? \"Invalid Date\"\n      : formatYear(date.getUTCFullYear(), 4) + \"-\" + pad(date.getUTCMonth() + 1, 2) + \"-\" + pad(date.getUTCDate(), 2)\n      + (milliseconds ? \"T\" + pad(hours, 2) + \":\" + pad(minutes, 2) + \":\" + pad(seconds, 2) + \".\" + pad(milliseconds, 3) + \"Z\"\n      : seconds ? \"T\" + pad(hours, 2) + \":\" + pad(minutes, 2) + \":\" + pad(seconds, 2) + \"Z\"\n      : minutes || hours ? \"T\" + pad(hours, 2) + \":\" + pad(minutes, 2) + \"Z\"\n      : \"\");\n}\n\nexport default function(delimiter) {\n  var reFormat = new RegExp(\"[\\\"\" + delimiter + \"\\n\\r]\"),\n      DELIMITER = delimiter.charCodeAt(0);\n\n  function parse(text, f) {\n    var convert, columns, rows = parseRows(text, function(row, i) {\n      if (convert) return convert(row, i - 1);\n      columns = row, convert = f ? customConverter(row, f) : objectConverter(row);\n    });\n    rows.columns = columns || [];\n    return rows;\n  }\n\n  function parseRows(text, f) {\n    var rows = [], // output rows\n        N = text.length,\n        I = 0, // current character index\n        n = 0, // current line number\n        t, // current token\n        eof = N <= 0, // current token followed by EOF?\n        eol = false; // current token followed by EOL?\n\n    // Strip the trailing newline.\n    if (text.charCodeAt(N - 1) === NEWLINE) --N;\n    if (text.charCodeAt(N - 1) === RETURN) --N;\n\n    function token() {\n      if (eof) return EOF;\n      if (eol) return eol = false, EOL;\n\n      // Unescape quotes.\n      var i, j = I, c;\n      if (text.charCodeAt(j) === QUOTE) {\n        while (I++ < N && text.charCodeAt(I) !== QUOTE || text.charCodeAt(++I) === QUOTE);\n        if ((i = I) >= N) eof = true;\n        else if ((c = text.charCodeAt(I++)) === NEWLINE) eol = true;\n        else if (c === RETURN) { eol = true; if (text.charCodeAt(I) === NEWLINE) ++I; }\n        return text.slice(j + 1, i - 1).replace(/\"\"/g, \"\\\"\");\n      }\n\n      // Find next delimiter or newline.\n      while (I < N) {\n        if ((c = text.charCodeAt(i = I++)) === NEWLINE) eol = true;\n        else if (c === RETURN) { eol = true; if (text.charCodeAt(I) === NEWLINE) ++I; }\n        else if (c !== DELIMITER) continue;\n        return text.slice(j, i);\n      }\n\n      // Return last token before EOF.\n      return eof = true, text.slice(j, N);\n    }\n\n    while ((t = token()) !== EOF) {\n      var row = [];\n      while (t !== EOL && t !== EOF) row.push(t), t = token();\n      if (f && (row = f(row, n++)) == null) continue;\n      rows.push(row);\n    }\n\n    return rows;\n  }\n\n  function preformatBody(rows, columns) {\n    return rows.map(function(row) {\n      return columns.map(function(column) {\n        return formatValue(row[column]);\n      }).join(delimiter);\n    });\n  }\n\n  function format(rows, columns) {\n    if (columns == null) columns = inferColumns(rows);\n    return [columns.map(formatValue).join(delimiter)].concat(preformatBody(rows, columns)).join(\"\\n\");\n  }\n\n  function formatBody(rows, columns) {\n    if (columns == null) columns = inferColumns(rows);\n    return preformatBody(rows, columns).join(\"\\n\");\n  }\n\n  function formatRows(rows) {\n    return rows.map(formatRow).join(\"\\n\");\n  }\n\n  function formatRow(row) {\n    return row.map(formatValue).join(delimiter);\n  }\n\n  function formatValue(value) {\n    return value == null ? \"\"\n        : value instanceof Date ? formatDate(value)\n        : reFormat.test(value += \"\") ? \"\\\"\" + value.replace(/\"/g, \"\\\"\\\"\") + \"\\\"\"\n        : value;\n  }\n\n  return {\n    parse: parse,\n    parseRows: parseRows,\n    format: format,\n    formatBody: formatBody,\n    formatRows: formatRows,\n    formatRow: formatRow,\n    formatValue: formatValue\n  };\n}\n","import {dsvFormat} from 'd3-dsv';\nimport {extend, stringValue} from 'vega-util';\n\nexport function delimitedFormat(delimiter) {\n  const parse = function(data, format) {\n    const delim = {delimiter: delimiter};\n    return dsv(data, format ? extend(format, delim) : delim);\n  };\n\n  parse.responseType = 'text';\n\n  return parse;\n}\n\nexport default function dsv(data, format) {\n  if (format.header) {\n    data = format.header\n      .map(stringValue)\n      .join(format.delimiter) + '\\n' + data;\n  }\n  return dsvFormat(format.delimiter).parse(data + '');\n}\n\ndsv.responseType = 'text';\n","import {\n  field, identity, isArray, isFunction, isIterable, isObject\n} from 'vega-util';\n\nfunction isBuffer(_) {\n  return (typeof Buffer === 'function' && isFunction(Buffer.isBuffer))\n    ? Buffer.isBuffer(_) : false;\n}\n\nexport default function json(data, format) {\n  const prop = (format && format.property) ? field(format.property) : identity;\n  return isObject(data) && !isBuffer(data)\n    ? parseJSON(prop(data), format)\n    : prop(JSON.parse(data));\n}\n\njson.responseType = 'json';\n\nfunction parseJSON(data, format) {\n  if (!isArray(data) && isIterable(data)) {\n    data = [...data];\n  }\n  return (format && format.copy)\n    ? JSON.parse(JSON.stringify(data))\n    : data;\n}\n","export default function(x) {\n  return x;\n}\n","import reverse from \"./reverse.js\";\nimport transform from \"./transform.js\";\n\nexport default function(topology, o) {\n  if (typeof o === \"string\") o = topology.objects[o];\n  return o.type === \"GeometryCollection\"\n      ? {type: \"FeatureCollection\", features: o.geometries.map(function(o) { return feature(topology, o); })}\n      : feature(topology, o);\n}\n\nfunction feature(topology, o) {\n  var id = o.id,\n      bbox = o.bbox,\n      properties = o.properties == null ? {} : o.properties,\n      geometry = object(topology, o);\n  return id == null && bbox == null ? {type: \"Feature\", properties: properties, geometry: geometry}\n      : bbox == null ? {type: \"Feature\", id: id, properties: properties, geometry: geometry}\n      : {type: \"Feature\", id: id, bbox: bbox, properties: properties, geometry: geometry};\n}\n\nexport function object(topology, o) {\n  var transformPoint = transform(topology.transform),\n      arcs = topology.arcs;\n\n  function arc(i, points) {\n    if (points.length) points.pop();\n    for (var a = arcs[i < 0 ? ~i : i], k = 0, n = a.length; k < n; ++k) {\n      points.push(transformPoint(a[k], k));\n    }\n    if (i < 0) reverse(points, n);\n  }\n\n  function point(p) {\n    return transformPoint(p);\n  }\n\n  function line(arcs) {\n    var points = [];\n    for (var i = 0, n = arcs.length; i < n; ++i) arc(arcs[i], points);\n    if (points.length < 2) points.push(points[0]); // This should never happen per the specification.\n    return points;\n  }\n\n  function ring(arcs) {\n    var points = line(arcs);\n    while (points.length < 4) points.push(points[0]); // This may happen if an arc has only two points.\n    return points;\n  }\n\n  function polygon(arcs) {\n    return arcs.map(ring);\n  }\n\n  function geometry(o) {\n    var type = o.type, coordinates;\n    switch (type) {\n      case \"GeometryCollection\": return {type: type, geometries: o.geometries.map(geometry)};\n      case \"Point\": coordinates = point(o.coordinates); break;\n      case \"MultiPoint\": coordinates = o.coordinates.map(point); break;\n      case \"LineString\": coordinates = line(o.arcs); break;\n      case \"MultiLineString\": coordinates = o.arcs.map(line); break;\n      case \"Polygon\": coordinates = polygon(o.arcs); break;\n      case \"MultiPolygon\": coordinates = o.arcs.map(polygon); break;\n      default: return null;\n    }\n    return {type: type, coordinates: coordinates};\n  }\n\n  return geometry(o);\n}\n","import identity from \"./identity.js\";\n\nexport default function(transform) {\n  if (transform == null) return identity;\n  var x0,\n      y0,\n      kx = transform.scale[0],\n      ky = transform.scale[1],\n      dx = transform.translate[0],\n      dy = transform.translate[1];\n  return function(input, i) {\n    if (!i) x0 = y0 = 0;\n    var j = 2, n = input.length, output = new Array(n);\n    output[0] = (x0 += input[0]) * kx + dx;\n    output[1] = (y0 += input[1]) * ky + dy;\n    while (j < n) output[j] = input[j], ++j;\n    return output;\n  };\n}\n","export default function(array, n) {\n  var t, j = array.length, i = j - n;\n  while (i < --j) t = array[i], array[i++] = array[j], array[j] = t;\n}\n","export default function(topology, arcs) {\n  var stitchedArcs = {},\n      fragmentByStart = {},\n      fragmentByEnd = {},\n      fragments = [],\n      emptyIndex = -1;\n\n  // Stitch empty arcs first, since they may be subsumed by other arcs.\n  arcs.forEach(function(i, j) {\n    var arc = topology.arcs[i < 0 ? ~i : i], t;\n    if (arc.length < 3 && !arc[1][0] && !arc[1][1]) {\n      t = arcs[++emptyIndex], arcs[emptyIndex] = i, arcs[j] = t;\n    }\n  });\n\n  arcs.forEach(function(i) {\n    var e = ends(i),\n        start = e[0],\n        end = e[1],\n        f, g;\n\n    if (f = fragmentByEnd[start]) {\n      delete fragmentByEnd[f.end];\n      f.push(i);\n      f.end = end;\n      if (g = fragmentByStart[end]) {\n        delete fragmentByStart[g.start];\n        var fg = g === f ? f : f.concat(g);\n        fragmentByStart[fg.start = f.start] = fragmentByEnd[fg.end = g.end] = fg;\n      } else {\n        fragmentByStart[f.start] = fragmentByEnd[f.end] = f;\n      }\n    } else if (f = fragmentByStart[end]) {\n      delete fragmentByStart[f.start];\n      f.unshift(i);\n      f.start = start;\n      if (g = fragmentByEnd[start]) {\n        delete fragmentByEnd[g.end];\n        var gf = g === f ? f : g.concat(f);\n        fragmentByStart[gf.start = g.start] = fragmentByEnd[gf.end = f.end] = gf;\n      } else {\n        fragmentByStart[f.start] = fragmentByEnd[f.end] = f;\n      }\n    } else {\n      f = [i];\n      fragmentByStart[f.start = start] = fragmentByEnd[f.end = end] = f;\n    }\n  });\n\n  function ends(i) {\n    var arc = topology.arcs[i < 0 ? ~i : i], p0 = arc[0], p1;\n    if (topology.transform) p1 = [0, 0], arc.forEach(function(dp) { p1[0] += dp[0], p1[1] += dp[1]; });\n    else p1 = arc[arc.length - 1];\n    return i < 0 ? [p1, p0] : [p0, p1];\n  }\n\n  function flush(fragmentByEnd, fragmentByStart) {\n    for (var k in fragmentByEnd) {\n      var f = fragmentByEnd[k];\n      delete fragmentByStart[f.start];\n      delete f.start;\n      delete f.end;\n      f.forEach(function(i) { stitchedArcs[i < 0 ? ~i : i] = 1; });\n      fragments.push(f);\n    }\n  }\n\n  flush(fragmentByEnd, fragmentByStart);\n  flush(fragmentByStart, fragmentByEnd);\n  arcs.forEach(function(i) { if (!stitchedArcs[i < 0 ? ~i : i]) fragments.push([i]); });\n\n  return fragments;\n}\n","import {object} from \"./feature.js\";\nimport stitch from \"./stitch.js\";\n\nexport default function(topology) {\n  return object(topology, meshArcs.apply(this, arguments));\n}\n\nexport function meshArcs(topology, object, filter) {\n  var arcs, i, n;\n  if (arguments.length > 1) arcs = extractArcs(topology, object, filter);\n  else for (i = 0, arcs = new Array(n = topology.arcs.length); i < n; ++i) arcs[i] = i;\n  return {type: \"MultiLineString\", arcs: stitch(topology, arcs)};\n}\n\nfunction extractArcs(topology, object, filter) {\n  var arcs = [],\n      geomsByArc = [],\n      geom;\n\n  function extract0(i) {\n    var j = i < 0 ? ~i : i;\n    (geomsByArc[j] || (geomsByArc[j] = [])).push({i: i, g: geom});\n  }\n\n  function extract1(arcs) {\n    arcs.forEach(extract0);\n  }\n\n  function extract2(arcs) {\n    arcs.forEach(extract1);\n  }\n\n  function extract3(arcs) {\n    arcs.forEach(extract2);\n  }\n\n  function geometry(o) {\n    switch (geom = o, o.type) {\n      case \"GeometryCollection\": o.geometries.forEach(geometry); break;\n      case \"LineString\": extract1(o.arcs); break;\n      case \"MultiLineString\": case \"Polygon\": extract2(o.arcs); break;\n      case \"MultiPolygon\": extract3(o.arcs); break;\n    }\n  }\n\n  geometry(object);\n\n  geomsByArc.forEach(filter == null\n      ? function(geoms) { arcs.push(geoms[0].i); }\n      : function(geoms) { if (filter(geoms[0].g, geoms[geoms.length - 1].g)) arcs.push(geoms[0].i); });\n\n  return arcs;\n}\n","import json from './json';\nimport {feature, mesh} from 'topojson-client';\nimport {error} from 'vega-util';\n\nconst filters = {\n  interior: (a, b) => a !== b,\n  exterior: (a, b) => a === b\n};\n\nexport default function topojson(data, format) {\n  let method, object, property, filter;\n  data = json(data, format);\n\n  if (format && format.feature) {\n    method = feature;\n    property = format.feature;\n  } else if (format && format.mesh) {\n    method = mesh;\n    property = format.mesh;\n    filter = filters[format.filter];\n  } else {\n    error('Missing TopoJSON feature or mesh parameter.');\n  }\n\n  object = (object = data.objects[property])\n    ? method(data, object, filter)\n    : error('Invalid TopoJSON object: ' + property);\n\n  return object && object.features || [object];\n}\n\ntopojson.responseType = 'json';\n","import {delimitedFormat, default as dsv} from './dsv';\nimport json from './json';\nimport topojson from './topojson';\nimport {hasOwnProperty} from 'vega-util';\n\nexport const format = {\n  dsv: dsv,\n  csv: delimitedFormat(','),\n  tsv: delimitedFormat('\\t'),\n  json: json,\n  topojson: topojson\n};\n\nexport function formats(name, reader) {\n  if (arguments.length > 1) {\n    format[name] = reader;\n    return this;\n  } else {\n    return hasOwnProperty(format, name) ? format[name] : null;\n  }\n}\n\nexport function responseType(type) {\n  const f = formats(type);\n  return f && f.responseType || 'text';\n}\n","import loaderFactory from './src/loader';\n\nexport const loader = loaderFactory(\n  typeof fetch !== 'undefined' && fetch, // use built-in fetch API\n  null // no file system access\n);\n\nexport {\n  default as read\n} from './src/read';\n\nexport {\n  inferType,\n  inferTypes,\n  typeParsers\n} from './src/type';\n\nexport {\n  format,\n  formats,\n  responseType\n} from './src/formats/index';\n","import {inferTypes, typeParsers} from './type';\nimport {formats} from './formats/index';\nimport {timeFormatDefaultLocale} from 'vega-format';\nimport {error, hasOwnProperty} from 'vega-util';\n\nexport default function(data, schema, timeParser, utcParser) {\n  schema = schema || {};\n\n  const reader = formats(schema.type || 'json');\n  if (!reader) error('Unknown data format type: ' + schema.type);\n\n  data = reader(data, schema);\n  if (schema.parse) parse(data, schema.parse, timeParser, utcParser);\n\n  if (hasOwnProperty(data, 'columns')) delete data.columns;\n  return data;\n}\n\nfunction parse(data, types, timeParser, utcParser) {\n  if (!data.length) return; // early exit for empty data\n\n  const locale = timeFormatDefaultLocale();\n  timeParser = timeParser || locale.timeParse;\n  utcParser = utcParser || locale.utcParse;\n\n  let fields = data.columns || Object.keys(data[0]),\n      datum, field, i, j, n, m;\n\n  if (types === 'auto') types = inferTypes(data, fields);\n\n  fields = Object.keys(types);\n  const parsers = fields.map(field => {\n    const type = types[field];\n    let parts, pattern;\n\n    if (type && (type.startsWith('date:') || type.startsWith('utc:'))) {\n      parts = type.split(/:(.+)?/, 2);  // split on first :\n      pattern = parts[1];\n\n      if ((pattern[0] === '\\'' && pattern[pattern.length-1] === '\\'') ||\n          (pattern[0] === '\"'  && pattern[pattern.length-1] === '\"')) {\n        pattern = pattern.slice(1, -1);\n      }\n\n      const parse = parts[0] === 'utc' ? utcParser : timeParser;\n      return parse(pattern);\n    }\n\n    if (!typeParsers[type]) {\n      throw Error('Illegal format pattern: ' + field + ':' + type);\n    }\n\n    return typeParsers[type];\n  });\n\n  for (i=0, n=data.length, m=fields.length; i<n; ++i) {\n    datum = data[i];\n    for (j=0; j<m; ++j) {\n      field = fields[j];\n      datum[field] = parsers[j](datum[field]);\n    }\n  }\n}\n"],"names":["protocol_re","allowed_re","whitespace_re","fileProtocol","async","load","uri","options","opt","this","sanitize","url","href","localFile","file","http","extend","fileAccess","result","isFile","loadFile","base","isAllowed","test","replace","error","stringValue","hasProtocol","baseURL","startsWith","length","mode","slice","defaultProtocol","Object","defineProperty","value","target","rel","context","crossOrigin","fileLoader","fs","filename","Promise","accept","reject","readFile","data","fileReject","httpLoader","fetch","type","response","ok","isFunction","text","status","statusText","httpReject","isNumber","_","Number","isNaN","Date","typeParsers","boolean","toBoolean","integer","toNumber","number","date","toDate","string","toString","unknown","identity","typeTests","isInteger","parse","typeList","inferType","values","field","n","m","a","map","i","j","t","reduce","u","v","inferTypes","fields","types","EOL","EOF","objectConverter","columns","Function","name","JSON","stringify","join","inferColumns","rows","columnSet","create","forEach","row","column","push","pad","width","s","Array","formatDate","year","hours","getUTCHours","minutes","getUTCMinutes","seconds","getUTCSeconds","milliseconds","getUTCMilliseconds","getUTCFullYear","getUTCMonth","getUTCDate","delimiter","reFormat","RegExp","DELIMITER","charCodeAt","parseRows","f","N","I","eof","eol","token","c","preformatBody","formatValue","formatRow","convert","object","customConverter","format","concat","formatBody","formatRows","delimitedFormat","delim","dsv","responseType","header","dsvFormat","json","prop","property","isObject","Buffer","isBuffer","isArray","isIterable","copy","parseJSON","x","topology","o","objects","features","geometries","feature","id","bbox","properties","geometry","transformPoint","transform","x0","y0","kx","scale","ky","dx","translate","dy","input","output","arcs","arc","points","pop","k","array","reverse","point","p","line","ring","polygon","coordinates","stitchedArcs","fragmentByStart","fragmentByEnd","fragments","emptyIndex","flush","start","end","g","e","p1","p0","dp","ends","fg","unshift","gf","meshArcs","apply","arguments","filter","extractArcs","stitch","geom","geomsByArc","extract0","extract1","extract2","extract3","geoms","filters","interior","b","exterior","topojson","method","mesh","csv","tsv","formats","reader","hasOwnProperty","loader","loaderFactory","schema","timeParser","utcParser","locale","timeFormatDefaultLocale","timeParse","utcParse","datum","keys","parsers","parts","pattern","split","Error"],"mappings":"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"}