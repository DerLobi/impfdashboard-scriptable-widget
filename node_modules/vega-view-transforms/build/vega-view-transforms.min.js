this.vega=this.vega||{},this.vega.transforms=function(t,e,n,o){"use strict";const r="top",a="left",i="right",s="bottom",c="start",u="middle",d="end",l="group",h="axis",f="title",m="frame",y="scope",b="legend",x="row-header",g="row-footer",p="row-title",w="column-header",k="column-footer",M="column-title",v="padding",E="fit",T="fit-x",A="fit-y",_="none",z="all",B="each",D="flush",O="column",S="row";function L(t){e.Transform.call(this,null,t)}function j(t,e,n){return e(t.bounds.clear(),t,n)}o.inherits(L,e.Transform,{transform(t,e){const o=e.dataflow,r=t.mark,a=r.marktype,i=n.Marks[a],s=i.bound;let c,u=r.bounds;if(i.nested)r.items.length&&o.dirty(r.items[0]),u=j(r,s),r.items.forEach(t=>{t.bounds.clear().union(u)});else if(a===l||t.modified())switch(e.visit(e.MOD,t=>o.dirty(t)),u.clear(),r.items.forEach(t=>u.union(j(t,s))),r.role){case h:case b:case f:e.reflow()}else c=e.changed(e.REM),e.visit(e.ADD,t=>{u.union(j(t,s))}),e.visit(e.MOD,t=>{c=c||u.alignsWith(t.bounds),o.dirty(t),u.union(j(t,s))}),c&&(u.clear(),r.items.forEach(t=>u.union(t.bounds)));return n.boundClip(r),e.modifies("bounds")}});const I=":vega_identifier:";function q(t){e.Transform.call(this,0,t)}function C(t){e.Transform.call(this,null,t)}function F(t){e.Transform.call(this,null,t)}q.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},o.inherits(q,e.Transform,{transform(t,e){const n=(r=e.dataflow)._signals[I]||(r._signals[I]=r.add(0)),o=t.as;var r;let a=n.value;return e.visit(e.ADD,t=>t[o]=t[o]||++a),n.set(this.value=a),e}}),o.inherits(C,e.Transform,{transform(t,e){let o=this.value;o||(o=e.dataflow.scenegraph().mark(t.markdef,function(t){const e=t.groups,n=t.parent;return e&&1===e.size?e.get(Object.keys(e.object)[0]):e&&n?e.lookup(n):null}(t),t.index),o.group.context=t.context,t.context.group||(t.context.group=o.group),o.source=this.source,o.clip=t.clip,o.interactive=t.interactive,this.value=o);const r=o.marktype===l?n.GroupItem:n.Item;return e.visit(e.ADD,t=>r.call(t,o)),(t.modified("clip")||t.modified("interactive"))&&(o.clip=t.clip,o.interactive=!!t.interactive,o.zdirty=!0,e.reflow()),o.items=e.source,e}});const G={parity:t=>t.filter((t,e)=>e%2?t.opacity=0:1),greedy:(t,e)=>{let n;return t.filter((t,o)=>o&&H(n.bounds,t.bounds,e)?t.opacity=0:(n=t,1))}},H=(t,e,n)=>n>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2),P=(t,e)=>{for(var n,o=1,r=t.length,a=t[0].bounds;o<r;a=n,++o)if(H(a,n=t[o].bounds,e))return!0},R=t=>{const e=t.bounds;return e.width()>1&&e.height()>1},U=t=>(t.forEach(t=>t.opacity=1),t),V=(t,e)=>t.reflow(e.modified()).modifies("opacity");function W(t){e.Transform.call(this,null,t)}o.inherits(F,e.Transform,{transform(t,e){const a=G[t.method]||G.parity,i=t.separation||0;let c,u,d=e.materialize(e.SOURCE).source;if(!d||!d.length)return;if(!t.method)return t.modified("method")&&(U(d),e=V(e,t)),e;if(d=d.filter(R),!d.length)return;if(t.sort&&(d=d.slice().sort(t.sort)),c=U(d),e=V(e,t),c.length>=3&&P(c,i)){do{c=a(c,i)}while(c.length>=3&&P(c,i));c.length<3&&!o.peek(d).opacity&&(c.length>1&&(o.peek(c).opacity=0),o.peek(d).opacity=1)}var l,h,f,m,y;t.boundScale&&t.boundTolerance>=0&&(l=t.boundScale,h=t.boundOrient,f=+t.boundTolerance,m=l.range(),y=new n.Bounds,h===r||h===s?y.set(m[0],-1/0,m[1],1/0):y.set(-1/0,m[0],1/0,m[1]),y.expand(f||1),u=t=>y.encloses(t.bounds),d.forEach(t=>{u(t)||(t.opacity=0)}));const b=c[0].mark.bounds.clear();return d.forEach(t=>{t.opacity&&b.union(t.bounds)}),e}}),o.inherits(W,e.Transform,{transform(t,e){const n=e.dataflow;if(e.visit(e.ALL,t=>n.dirty(t)),e.fields&&e.fields.zindex){const t=e.source&&e.source[0];t&&(t.mark.zdirty=!0)}}});const J=new n.Bounds;function K(t,e,n){return t[e]===n?0:(t[e]=n,1)}function N(t){var e=t.items[0].orient;return e===a||e===i}function Q(t,e,o,c){var u,d,l=e.items[0],h=l.datum,f=null!=l.translate?l.translate:.5,m=l.orient,y=function(t){let e=+t.grid;return[t.ticks?e++:-1,t.labels?e++:-1,e+ +t.domain]}(h),b=l.range,x=l.offset,g=l.position,p=l.minExtent,w=l.maxExtent,k=h.title&&l.items[y[2]].items[0],M=l.titlePadding,v=l.bounds,E=k&&n.multiLineOffset(k),T=0,A=0;switch(J.clear().union(v),v.clear(),(u=y[0])>-1&&v.union(l.items[u].bounds),(u=y[1])>-1&&v.union(l.items[u].bounds),m){case r:T=g||0,A=-x,d=Math.max(p,Math.min(w,-v.y1)),v.add(0,-d).add(b,0),k&&X(t,k,d,M,E,0,-1,v);break;case a:T=-x,A=g||0,d=Math.max(p,Math.min(w,-v.x1)),v.add(-d,0).add(0,b),k&&X(t,k,d,M,E,1,-1,v);break;case i:T=o+x,A=g||0,d=Math.max(p,Math.min(w,v.x2)),v.add(0,0).add(d,b),k&&X(t,k,d,M,E,1,1,v);break;case s:T=g||0,A=c+x,d=Math.max(p,Math.min(w,v.y2)),v.add(0,0).add(b,d),k&&X(t,k,d,M,0,0,1,v);break;default:T=l.x,A=l.y}return n.boundStroke(v.translate(T,A),l),K(l,"x",T+f)|K(l,"y",A+f)&&(l.bounds=J,t.dirty(l),l.bounds=v,t.dirty(l)),l.mark.bounds.clear().union(v)}function X(t,e,n,o,r,a,i,s){const c=e.bounds;if(e.auto){const s=i*(n+r+o);let u=0,d=0;t.dirty(e),a?u=(e.x||0)-(e.x=s):d=(e.y||0)-(e.y=s),e.mark.bounds.clear().union(c.translate(-u,-d)),t.dirty(e)}s.union(c)}const Y=(t,e)=>Math.floor(Math.min(t,e)),Z=(t,e)=>Math.ceil(Math.max(t,e));function $(t){return(new n.Bounds).set(0,0,t.width||0,t.height||0)}function tt(t){const e=t.bounds.clone();return e.empty()?e.set(0,0,0,0):e.translate(-(t.x||0),-(t.y||0))}function et(t,e,n){const r=o.isObject(t)?t[e]:t;return null!=r?r:void 0!==n?n:0}function nt(t){return t<0?Math.ceil(-t):0}function ot(t,e,n){var o,r,a,i,s,c,l,h,f,m,y,b=!n.nodirty,x=n.bounds===D?$:tt,g=J.set(0,0,0,0),p=et(n.align,O),w=et(n.align,S),k=et(n.padding,O),M=et(n.padding,S),v=n.columns||e.length,E=v<=0?1:Math.ceil(e.length/v),T=e.length,A=Array(T),_=Array(v),L=0,j=Array(T),I=Array(E),q=0,C=Array(T),F=Array(T),G=Array(T);for(r=0;r<v;++r)_[r]=0;for(r=0;r<E;++r)I[r]=0;for(r=0;r<T;++r)c=e[r],s=G[r]=x(c),c.x=c.x||0,C[r]=0,c.y=c.y||0,F[r]=0,a=r%v,i=~~(r/v),L=Math.max(L,l=Math.ceil(s.x2)),q=Math.max(q,h=Math.ceil(s.y2)),_[a]=Math.max(_[a],l),I[i]=Math.max(I[i],h),A[r]=k+nt(s.x1),j[r]=M+nt(s.y1),b&&t.dirty(e[r]);for(r=0;r<T;++r)r%v==0&&(A[r]=0),r<v&&(j[r]=0);if(p===B)for(a=1;a<v;++a){for(y=0,r=a;r<T;r+=v)y<A[r]&&(y=A[r]);for(r=a;r<T;r+=v)A[r]=y+_[a-1]}else if(p===z){for(y=0,r=0;r<T;++r)r%v&&y<A[r]&&(y=A[r]);for(r=0;r<T;++r)r%v&&(A[r]=y+L)}else for(p=!1,a=1;a<v;++a)for(r=a;r<T;r+=v)A[r]+=_[a-1];if(w===B)for(i=1;i<E;++i){for(y=0,o=(r=i*v)+v;r<o;++r)y<j[r]&&(y=j[r]);for(r=i*v;r<o;++r)j[r]=y+I[i-1]}else if(w===z){for(y=0,r=v;r<T;++r)y<j[r]&&(y=j[r]);for(r=v;r<T;++r)j[r]=y+q}else for(w=!1,i=1;i<E;++i)for(o=(r=i*v)+v;r<o;++r)j[r]+=I[i-1];for(f=0,r=0;r<T;++r)f=A[r]+(r%v?f:0),C[r]+=f-e[r].x;for(a=0;a<v;++a)for(m=0,r=a;r<T;r+=v)m+=j[r],F[r]+=m-e[r].y;if(p&&et(n.center,O)&&E>1)for(r=0;r<T;++r)(f=(s=p===z?L:_[r%v])-G[r].x2-e[r].x-C[r])>0&&(C[r]+=f/2);if(w&&et(n.center,S)&&1!==v)for(r=0;r<T;++r)(m=(s=w===z?q:I[~~(r/v)])-G[r].y2-e[r].y-F[r])>0&&(F[r]+=m/2);for(r=0;r<T;++r)g.union(G[r].translate(C[r],F[r]));switch(f=et(n.anchor,"x"),m=et(n.anchor,"y"),et(n.anchor,O)){case d:f-=g.width();break;case u:f-=g.width()/2}switch(et(n.anchor,S)){case d:m-=g.height();break;case u:m-=g.height()/2}for(f=Math.round(f),m=Math.round(m),g.clear(),r=0;r<T;++r)e[r].mark.bounds.clear();for(r=0;r<T;++r)(c=e[r]).x+=C[r]+=f,c.y+=F[r]+=m,g.union(c.mark.bounds.union(c.bounds.translate(C[r],F[r]))),b&&t.dirty(c);return g}function rt(t,e,n){var o,r,a,i,s,c,u,m=function(t){var e,n,o=t.items,r=o.length,a=0;const i={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;a<r;++a)if(n=(e=o[a]).items,e.marktype===l)switch(e.role){case h:case b:case f:break;case x:i.rowheaders.push(...n);break;case g:i.rowfooters.push(...n);break;case w:i.colheaders.push(...n);break;case k:i.colfooters.push(...n);break;case p:i.rowtitle=n[0];break;case M:i.coltitle=n[0];break;default:i.marks.push(...n)}return i}(e),y=m.marks,v=n.bounds===D?at:it,E=n.offset,T=n.columns||y.length,A=T<=0?1:Math.ceil(y.length/T),_=A*T;const z=ot(t,y,n);z.empty()&&z.set(0,0,0,0),m.rowheaders&&(c=et(n.headerBand,S,null),o=st(t,m.rowheaders,y,T,A,-et(E,"rowHeader"),Y,0,v,"x1",0,T,1,c)),m.colheaders&&(c=et(n.headerBand,O,null),r=st(t,m.colheaders,y,T,T,-et(E,"columnHeader"),Y,1,v,"y1",0,1,T,c)),m.rowfooters&&(c=et(n.footerBand,S,null),a=st(t,m.rowfooters,y,T,A,et(E,"rowFooter"),Z,0,v,"x2",T-1,T,1,c)),m.colfooters&&(c=et(n.footerBand,O,null),i=st(t,m.colfooters,y,T,T,et(E,"columnFooter"),Z,1,v,"y2",_-T,1,T,c)),m.rowtitle&&(s=et(n.titleAnchor,S),u=et(E,"rowTitle"),u=s===d?a+u:o-u,c=et(n.titleBand,S,.5),ct(t,m.rowtitle,u,0,z,c)),m.coltitle&&(s=et(n.titleAnchor,O),u=et(E,"columnTitle"),u=s===d?i+u:r-u,c=et(n.titleBand,O,.5),ct(t,m.coltitle,u,1,z,c))}function at(t,e){return"x1"===e?t.x||0:"y1"===e?t.y||0:"x2"===e?(t.x||0)+(t.width||0):"y2"===e?(t.y||0)+(t.height||0):void 0}function it(t,e){return t.bounds[e]}function st(t,e,n,o,r,a,i,s,c,u,d,l,h,f){var m,y,b,x,g,p,w,k,M,v=n.length,E=0,T=0;if(!v)return E;for(m=d;m<v;m+=l)n[m]&&(E=i(E,c(n[m],u)));if(!e.length)return E;for(e.length>r&&(t.warn("Grid headers exceed limit: "+r),e=e.slice(0,r)),E+=a,y=0,x=e.length;y<x;++y)t.dirty(e[y]),e[y].mark.bounds.clear();for(m=d,y=0,x=e.length;y<x;++y,m+=l){for(g=(p=e[y]).mark.bounds,b=m;b>=0&&null==(w=n[b]);b-=h);s?(k=null==f?w.x:Math.round(w.bounds.x1+f*w.bounds.width()),M=E):(k=E,M=null==f?w.y:Math.round(w.bounds.y1+f*w.bounds.height())),g.union(p.bounds.translate(k-(p.x||0),M-(p.y||0))),p.x=k,p.y=M,t.dirty(p),T=i(T,g[u])}return T}function ct(t,e,n,o,r,a){if(e){t.dirty(e);var i=n,s=n;o?i=Math.round(r.x1+a*r.width()):s=Math.round(r.y1+a*r.height()),e.bounds.translate(i-(e.x||0),s-(e.y||0)),e.mark.bounds.clear().union(e.bounds),e.x=i,e.y=s,t.dirty(e)}}function ut(t,e,n,o,l,h,f){const m=function(t,e){const n=t[e]||{};return(e,o)=>null!=n[e]?n[e]:null!=t[e]?t[e]:o}(n,e),y=function(t,e){let n=-1/0;return t.forEach(t=>{null!=t.offset&&(n=Math.max(n,t.offset))}),n>-1/0?n:e}(t,m("offset",0)),b=m("anchor",c),x=b===d?1:b===u?.5:0,g={align:B,bounds:m("bounds",D),columns:"vertical"===m("direction")?1:t.length,padding:m("margin",8),center:m("center"),nodirty:!0};switch(e){case a:g.anchor={x:Math.floor(o.x1)-y,column:d,y:x*(f||o.height()+2*o.y1),row:b};break;case i:g.anchor={x:Math.ceil(o.x2)+y,y:x*(f||o.height()+2*o.y1),row:b};break;case r:g.anchor={y:Math.floor(l.y1)-y,row:d,x:x*(h||l.width()+2*l.x1),column:b};break;case s:g.anchor={y:Math.ceil(l.y2)+y,x:x*(h||l.width()+2*l.x1),column:b};break;case"top-left":g.anchor={x:y,y:y};break;case"top-right":g.anchor={x:h-y,y:y,column:d};break;case"bottom-left":g.anchor={x:y,y:f-y,row:d};break;case"bottom-right":g.anchor={x:h-y,y:f-y,column:d,row:d}}return g}function dt(t,e){var o,r,c=e.items[0],u=c.datum,l=c.orient,h=c.bounds,f=c.x,m=c.y;return c._bounds?c._bounds.clear().union(h):c._bounds=h.clone(),h.clear(),function(t,e,n){var o=e.padding,r=o-n.x,c=o-n.y;if(e.datum.title){var u=e.items[1].items[0],l=u.anchor,h=e.titlePadding||0,f=o-u.x,m=o-u.y;switch(u.orient){case a:r+=Math.ceil(u.bounds.width())+h;break;case i:case s:break;default:c+=u.bounds.height()+h}switch((r||c)&&ht(t,n,r,c),u.orient){case a:m+=lt(e,n,u,l,1,1);break;case i:f+=lt(e,n,u,d,0,0)+h,m+=lt(e,n,u,l,1,1);break;case s:f+=lt(e,n,u,l,0,0),m+=lt(e,n,u,d,-1,0,1)+h;break;default:f+=lt(e,n,u,l,0,0)}(f||m)&&ht(t,u,f,m),(f=Math.round(u.bounds.x1-o))<0&&(ht(t,n,-f,0),ht(t,u,-f,0))}else(r||c)&&ht(t,n,r,c)}(t,c,c.items[0].items[0]),h=function(t,e){return t.items.forEach(t=>e.union(t.bounds)),e.x1=t.padding,e.y1=t.padding,e}(c,h),o=2*c.padding,r=2*c.padding,h.empty()||(o=Math.ceil(h.width()+o),r=Math.ceil(h.height()+r)),"symbol"===u.type&&function(t){const e=t.reduce((t,e)=>(t[e.column]=Math.max(e.bounds.x2-e.x,t[e.column]||0),t),{});t.forEach(t=>{t.width=e[t.column],t.height=t.bounds.y2-t.y})}(c.items[0].items[0].items[0].items),l!==_&&(c.x=f=0,c.y=m=0),c.width=o,c.height=r,n.boundStroke(h.set(f,m,f+o,m+r),c),c.mark.bounds.clear().union(h),c}function lt(t,e,o,r,a,i,s){const u="symbol"!==t.datum.type,l=o.datum.vgrad,h=(!u||!i&&l||s?e:e.items[0]).bounds[a?"y2":"x2"]-t.padding,f=l&&i?h:0,m=l&&i?0:h,y=a<=0?0:n.multiLineOffset(o);return Math.round(r===c?f:r===d?m-y:.5*(h-y))}function ht(t,e,n,o){e.x+=n,e.y+=o,e.bounds.translate(n,o),e.mark.bounds.translate(n,o),t.dirty(e)}function ft(t){e.Transform.call(this,null,t)}return o.inherits(ft,e.Transform,{transform(t,e){const o=e.dataflow;return t.mark.items.forEach(e=>{t.layout&&rt(o,e,t.layout),function(t,e,o){var u,z,B,D,O,S=e.items,L=Math.max(0,e.width||0),j=Math.max(0,e.height||0),I=(new n.Bounds).set(0,0,L,j),q=I.clone(),C=I.clone(),F=[];for(D=0,O=S.length;D<O;++D)switch((z=S[D]).role){case h:(N(z)?q:C).union(Q(t,z,L,j));break;case f:u=z;break;case b:F.push(dt(t,z));break;case m:case y:case x:case g:case p:case w:case k:case M:q.union(z.bounds),C.union(z.bounds);break;default:I.union(z.bounds)}if(F.length){const e={};F.forEach(t=>{(B=t.orient||i)!==_&&(e[B]||(e[B]=[])).push(t)});for(const n in e){const r=e[n];ot(t,r,ut(r,n,o.legends,q,C,L,j))}F.forEach(e=>{const n=e.bounds;if(n.equals(e._bounds)||(e.bounds=e._bounds,t.dirty(e),e.bounds=n,t.dirty(e)),o.autosize&&o.autosize.type===E)switch(e.orient){case a:case i:I.add(n.x1,0).add(n.x2,0);break;case r:case s:I.add(0,n.y1).add(0,n.y2)}else I.union(n)})}I.union(q).union(C),u&&I.union(function(t,e,n,o,u){var h,f=e.items[0],m=f.frame,y=f.orient,b=f.anchor,x=f.offset,g=f.padding,p=f.items[0].items[0],w=f.items[1]&&f.items[1].items[0],k=y===a||y===i?o:n,M=0,v=0,E=0,T=0,A=0;if(m!==l?y===a?(M=u.y2,k=u.y1):y===i?(M=u.y1,k=u.y2):(M=u.x1,k=u.x2):y===a&&(M=o,k=0),h=b===c?M:b===d?k:(M+k)/2,w&&w.text){switch(y){case r:case s:A=p.bounds.height()+g;break;case a:T=p.bounds.width()+g;break;case i:T=-p.bounds.width()-g}J.clear().union(w.bounds),J.translate(T-(w.x||0),A-(w.y||0)),K(w,"x",T)|K(w,"y",A)&&(t.dirty(w),w.bounds.clear().union(J),w.mark.bounds.clear().union(J),t.dirty(w)),J.clear().union(w.bounds)}else J.clear();switch(J.union(p.bounds),y){case r:v=h,E=u.y1-J.height()-x;break;case a:v=u.x1-J.width()-x,E=h;break;case i:v=u.x2+J.width()+x,E=h;break;case s:v=h,E=u.y2+x;break;default:v=f.x,E=f.y}return K(f,"x",v)|K(f,"y",E)&&(J.translate(v,E),t.dirty(f),f.bounds.clear().union(J),e.bounds.clear().union(J),t.dirty(f)),f.bounds}(t,u,L,j,I));e.clip&&I.set(0,0,e.width||0,e.height||0);!function(t,e,n,o){const r=o.autosize||{},a=r.type;if(t._autosize<1||!a)return;let i=t._width,s=t._height,c=Math.max(0,e.width||0),u=Math.max(0,Math.ceil(-n.x1)),d=Math.max(0,e.height||0),l=Math.max(0,Math.ceil(-n.y1));const h=Math.max(0,Math.ceil(n.x2-c)),f=Math.max(0,Math.ceil(n.y2-d));if(r.contains===v){const e=t.padding();i-=e.left+e.right,s-=e.top+e.bottom}a===_?(u=0,l=0,c=i,d=s):a===E?(c=Math.max(0,i-u-h),d=Math.max(0,s-l-f)):a===T?(c=Math.max(0,i-u-h),s=d+l+f):a===A?(i=c+u+h,d=Math.max(0,s-l-f)):"pad"===a&&(i=c+u+h,s=d+l+f);t._resizeView(i,s,c,d,[u,l],r.resize)}(t,e,I,o)}(o,e,t)}),(u=t.mark.group)&&"legend-entry"!==u.mark.role?e.reflow():e;var u}}),t.bound=L,t.identifier=q,t.mark=C,t.overlap=F,t.render=W,t.viewlayout=ft,t}({},vega,vega,vega);
//# sourceMappingURL=vega-view-transforms.min.js.map
